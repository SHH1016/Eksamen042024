<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pokemons</title>
  </head>
  <body>
    <input type="text" placeholder="Pokemon navn" id="pokemon-name" />
    <input type="text" placeholder="Pokemon type" id="pokemon-type" />
    <input type="button" value="Legg til" id="add-pokemon" />
    <div id="pokemon-container"></div>
    <h1>Dine lagrede Pokemons</h1>
    <div id="pokemon-saved-container"></div>
   
    <script>
      let pokemonData = [];

      savedPokemons = [];

      const addNewName = document.querySelector("#pokemon-name");

      const addNewType = document.querySelector("#pokemon-type");

      const addNewPokemon = document.querySelector("#add-pokemon");

      async function fetchAllPokemon() {
        try {
          const response = await fetch(
            "https://pokeapi.co/api/v2/pokemon?limit=50"
          );
          const data = await response.json();

          const pokemons = data.results.map(async function (pokemon) {
            const response = await fetch(pokemon.url);
            return response.json();
          });
          pokemonData = await Promise.all(pokemons);
          console.log(pokemonData);
          displayAllPokemon(pokemonData);
        } catch (error) {
          console.error("Klarte ikke hente respons fra API", error);
        }
      }
      fetchAllPokemon();

      async function displayAllPokemon(pokemonData) {
        const pokemonContainer = document.querySelector("#pokemon-container");
        pokemonContainer.innerHTML = "";
        pokemonData.forEach(async function (pokemon) {
          const pokemonCard = document.createElement("div");
          pokemonCard.classList.add("pokemon-card");

          const pokemonName = document.createElement("p");
          pokemonName.classList.add("pokemon-name");
          pokemonName.innerHTML = `Navn: ${pokemon.name}`;

          const pokemonImage = document.createElement("img");
          pokemonImage.classList.add("pokemon-image");
          pokemonImage.src = pokemon.sprites.front_default;

          const pokemonType = document.createElement("p");
          pokemonType.classList.add("pokemon-type");
          pokemonType.innerHTML = `Type: ${pokemon.types[0].type.name}`;

          //Button
          const deleteBtn = document.createElement("button");
          deleteBtn.innerHTML = "Slett Pokemon";

          const saveBtn = document.createElement("button");
          saveBtn.innerHTML = "Lagre Pokemon";

          const editBtn = document.createElement("button");
          editBtn.innerHTML = "Rediger Pokemon";

          //funskjoner
          deleteBtn.addEventListener("click", function () {
            deletePokemon(pokemon);
          });
          saveBtn.addEventListener("click", () => savePokemon(pokemon));
          editBtn.addEventListener("click", () => editPokemon(pokemon));

          pokemonCard.append(
            pokemonImage,
            pokemonName,
            pokemonType,
            saveBtn,
            editBtn,
            deleteBtn
          );
          pokemonContainer.appendChild(pokemonCard);
        });
      }
      //lagrede pokemon display
      async function displaySavedPokemon() {
        try {
          const savedPokemonsContainer = document.querySelector(
            "#pokemon-saved-container"
          );
          savedPokemonsContainer.innerHTML = "";
          let savedPokemons =
            JSON.parse(localStorage.getItem("savedPokemons")) || [];
          maxLimitPokemon = savedPokemons.length;

          savedPokemons.forEach((pokemon) => {
            const pokemonCard = document.createElement("div");
            pokemonCard.classList.add("pokemon-card");

            const pokemonName = document.createElement("p");
            pokemonName.classList.add("pokemon-name");
            pokemonName.innerHTML = `Navn: ${pokemon.name}`;

            const pokemonImage = document.createElement("img");
            pokemonImage.classList.add("pokemon-image");
            pokemonImage.src = pokemon.sprites.front_default;

            const pokemonType = document.createElement("p");
            pokemonType.classList.add("pokemon-type");
            pokemonType.innerHTML = `Type: ${pokemon.types[0].type.name}`;

            //Button funskjoner
            const deleteBtn = document.createElement("button");
            deleteBtn.innerHTML = "Slett Pokemon";

            const saveBtn = document.createElement("button");
            saveBtn.innerHTML = "Lagre Pokemon";

            // const editBtn = document.createElement("button");
            //editBtn.innerHTML = "Rediger Pokemon";

            deleteBtn.addEventListener("click", function () {
              deletePokemon(pokemon);
            });

            // editBtn.addEventListener("click", function () {
            // editPokemon(pokemon);
            //});

            pokemonCard.append(
              pokemonImage,
              pokemonName,
              pokemonType,
              deleteBtn
            );
            savedPokemonsContainer.appendChild(pokemonCard);
          });
        } catch (error) {
          console.error("Klarte ikke laste inn lagrede pokemon");
        }
      }
      displaySavedPokemon();

      async function savePokemon(pokemon) {
        try {
          let savedPokemons =
            JSON.parse(localStorage.getItem("savedPokemons")) || [];
          maxLimitPokemon = savedPokemons.length;

          const checkPokemon = savedPokemons.some(
            (poke) => poke.name === pokemon.name
          );

          if (maxLimitPokemon <= 5 && !checkPokemon) {
            savedPokemons.push(pokemon);

            localStorage.setItem(
              "savedPokemons",
              JSON.stringify(savedPokemons)
            );
            displaySavedPokemon();
          } else if (maxLimitPokemon >= 5) {
            alert(
              "Du har nådd maksgrensen på storage, slett en lagret pokemon"
            );
          }
        } catch (error) {
          console.error("Klarte ikke å lagre pokemon til localstorage", error);
        }
      }

      //slette pokemon
      async function deletePokemon(pokemonDelete) {
        try {
          let savedPokemons =
            JSON.parse(localStorage.getItem("savedPokemons")) || [];

          savedPokemons = savedPokemons.filter(
            (pokeSaved) => pokeSaved.name !== pokemonDelete.name
          );
          localStorage.setItem("savedPokemons", JSON.stringify(savedPokemons));

          if (savedPokemons) {
            const index = pokemonData.findIndex(
              (poke) => poke.name === pokemonDelete.name
            );
            if (index !== -1) {
              pokemonData = pokemonData.filter(
                (poke) => poke.name !== pokemonDelete.name
              );
            }
          }

          displayAllPokemon(pokemonData);
          displaySavedPokemon();
        } catch (error) {
          console.error(
            "klarte ikke å slette pokemon fra array eller localstorage",
            error
          );
        }
      }
      //redigere pokemon
      async function editPokemon(index) {
        try {
          console.log(`index:`, index);
          console.log(`pokemonData:`, pokemonData);
          // console.log(`pokemonførendring:`,pokemonData[indexOfPokemon]);

          const newPokeName = prompt("Gi et nytt Navn");
          const newPokeType = prompt("Gi en ny Type");

          let indexOfPokemon = pokemonData.findIndex(
            (pokemon) => pokemon.name === index.name
          );
          console.log(`indexOfPokemon:`, indexOfPokemon);

          if (newPokeName && newPokeType && indexOfPokemon !== -1) {
            pokemonData[indexOfPokemon].name = newPokeName;
            pokemonData[indexOfPokemon].types[0].type.name = newPokeType;
          }

          displayAllPokemon(pokemonData);
        } catch (error) {
          console.error("Klarte ikke endre på navn og type", error);
        }
      }
      //Lag din egen pokemon
      async function createNewPokemon() {
       
        try {
          const newPokemon = {
            name: addNewName.value,
            types: [{ type: { name: addNewType.value } }],
            sprites: {
              front_default: "assets/pokemon-png-18174.png"
            },
          };
          pokemonData.unshift(newPokemon);
          console.log(pokemonData);
          displayAllPokemon(pokemonData);
        } catch (error) {
          console.error(
            "Klarte ikke legge til ny pokemon i pokemonData",
            error
          );
        }
        addNewType.value = "";
        addNewName.value = "";
      }
      addNewPokemon.addEventListener("click", () => createNewPokemon());
    </script>
  </body>
</html>
