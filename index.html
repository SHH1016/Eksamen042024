<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pokemons</title>
  </head>
  <body>
    <div id="pokemon-container"></div>
    <div id="pokemon-saved-container">Dine lagrede pokemon</div>
    <script>
      let pokemonData;

      let savedPokemons = [];

      
        /*
      //https://medium.com/@sergio13prez/fetching-them-all-poke-api-62ca580981a2
      async function fetchAllPokemon() {
        try {
          fetch("https://pokeapi.co/api/v2/pokemon?limit=50")
            .then((response) => response.json())
            .then(function (allPokemon) {
              allPokemon.results.forEach(function (pokemon) {
                fetchPokemonData(pokemon);
                
              });
            
              
            });
        } catch (error) {
          console.error("Klarte inne å fetche respons fra api", error);
        }
      }
      fetchAllPokemon();

      async function fetchPokemonData(pokemon) {
        try {
          let url = pokemon.url;
          fetch(url)
            .then((response) => response.json())
            .then(function (pokeData) {
              console.log(pokeData, "inne i fetchPokemonData");
              displayAllPokemon(pokeData);
            });
        } catch (error) {
          console.error("Klarte ikke hente data fra url", error);
        }
      }*/
      async function fetchAllPokemon (){
        try{
            const response = await fetch("https://pokeapi.co/api/v2/pokemon?limit=50")
            const data = await response.json();

            const pokemons = data.results.map(async function(pokemon){
                const response = await fetch(pokemon.url);
                return response.json();
            })
            const pokemonData = await Promise.all(pokemons);
            console.log(pokemonData);
            displayAllPokemon(pokemonData);

        }catch (error){
            console.error("Klarte ikke hente respons fra API",error);
        }
      }
      fetchAllPokemon();
      
      
      async function displayAllPokemon(pokemonData) {
        const pokemonContainer = document.querySelector("#pokemon-container");
        //pokemonContainer.innerHTML = "";
        pokemonData.forEach(async function(pokemon){
            
            const pokemonCard = document.createElement("div");
        pokemonCard.classList.add("pokemon-card");

        const pokemonName = document.createElement("p");
        pokemonName.classList.add("pokemon-name");
        pokemonName.innerHTML = `Navn: ${pokemon.name}`;

        const pokemonImage = document.createElement("img");
        pokemonImage.classList.add("pokemon-image");
        pokemonImage.src = pokemon.sprites.front_default;

        const pokemonType = document.createElement("p");
        pokemonType.classList.add("pokemon-type");
        pokemonType.innerHTML = `Type: ${pokemon.types[0].type.name}`;

        //Button funskjoner
        const deleteBtn = document.createElement("button");
        deleteBtn.innerHTML = "Slett Pokemon";

        const saveBtn = document.createElement("button");
        saveBtn.innerHTML = "Lagre Pokemon";

        const editBtn = document.createElement("button");
        editBtn.innerHTML = "Rediger Pokemon";

        deleteBtn.addEventListener("click", function () {
          deletePokemon(pokemon);
        });
        saveBtn.addEventListener("click", () => savePokemon(pokemon));
        editBtn.addEventListener("click", function () {
          editPokemon(pokemon);
        });

        pokemonCard.append(
          pokemonImage,
          pokemonName,
          pokemonType,
          saveBtn,
          editBtn,
          deleteBtn
        );
        pokemonContainer.appendChild(pokemonCard);
        })
       

       
      }
      function displaySavedPokemon(pokemon){
        const savedPokemonsContainer = document.querySelector("#pokemon-saved-container");

        const pokemonCard = document.createElement("div");
        pokemonCard.classList.add("pokemon-card");

        const pokemonName = document.createElement("p");
        pokemonName.classList.add("pokemon-name");
        pokemonName.innerHTML = `Navn: ${pokemon.name}`;

        const pokemonImage = document.createElement("img");
        pokemonImage.classList.add("pokemon-image");
        pokemonImage.src = pokemon.sprites.front_default;

        const pokemonType = document.createElement("p");
        pokemonType.classList.add("pokemon-type");
        pokemonType.innerHTML = `Type: ${pokemon.types[0].type.name}`;

        //Button funskjoner
        const deleteBtn = document.createElement("button");
        deleteBtn.innerHTML = "Slett Pokemon";

        const saveBtn = document.createElement("button");
        saveBtn.innerHTML = "Lagre Pokemon";

        const editBtn = document.createElement("button");
        editBtn.innerHTML = "Rediger Pokemon";

        deleteBtn.addEventListener("click", function () {
          deletePokemon(pokemon);
        });
        saveBtn.addEventListener("click", () => savePokemon(pokemon));
        editBtn.addEventListener("click", function () {
          editPokemon(pokemon);
        });

        pokemonCard.append(
          pokemonImage,
          pokemonName,
          pokemonType,
          saveBtn,
          editBtn,
          deleteBtn
        );
        savedPokemonsContainer.appendChild(pokemonCard);
      }
     // displaySavedPokemon(pokemon);
      
      //lagre pokemon
      async function savePokemon(pokemon) {
        try {
          let savedPokemons =
            JSON.parse(localStorage.getItem("savedPokemons")) || [];
            //savedOnDisplay(pokemon);
          maxLimitPokemon = savedPokemons.length + 1;

          if (maxLimitPokemon <= 5) {
            savedPokemons.push(pokemon);

            localStorage.setItem(
              "savedPokemons",
              JSON.stringify(savedPokemons)
            );
            displaySavedPokemon(pokemon);
           // savedOnDisplay(pokemon);
            
          } else if (maxLimitPokemon >= 5) {
            alert(
              "Du har nådd maksgrensen på storage, slett en lagret pokemon"
            );
          }
        } catch (error) {
          console.error("Klarte ikke å lagre pokemon til localstorage", error);
        }
      }
      
      async function savedOnDisplay(){
        try{
            let savedPokemons = JSON.parse(localStorage.getItem("savedPokemons")) || [];
            savedPokemons.forEach(pokemon => displaySavedPokemon(pokemon))
        }catch (error){
            console.error("Klarte ikke laste inn dine lagrede pokemon",error);
        }
      }
     window.onload = savedOnDisplay;
      
      //slette pokemon
      async function deletePokemon(pokemon) {
        try {
            
            let savedPokemons = JSON.parse(localStorage.getItem("savedPokemons")) || [];
            const index = savedPokemons.findIndex(savedPokemons => savedPokemons.name === pokemon.name);
            allPokemon.splice(index,1);
            savedPokemons.splice(index,1);
            localStorage.setItem(
              "savedPokemons",
              JSON.stringify(savedPokemons)
            );
            //displaySavedPokemon(pokemon);
            

        } catch (error){
            console.error("klarte ikke å slette pokemon fra array eller localstorage",error);
        }
      }
    </script>
  </body>
</html>
